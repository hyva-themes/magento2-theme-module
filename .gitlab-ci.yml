
# Defaults
variables:
  SRC_DIR: './src'
  # Set to 'integration' or 'playwright' in the "Run Pipeline" UI to run only that job type
  RUN_ONLY: ''

include:
  - project: 'hyva-themes/base-ci'
    file: 'lint/php.yml'
    ref: main
  - project: 'hyva-themes/base-ci'
    file: 'static/phpcs.yml'
    ref: main
  - project: 'hyva-themes/base-ci'
    file: 'test/integration.yml'
    ref: main
  - project: 'hyva-themes/base-ci'
    file: 'test/theme-playwright.yml'
    ref: main

# Override static jobs from includes to skip when RUN_ONLY is set
static:lint:
  rules:
    - if: $RUN_ONLY != ''
      when: never
    - when: on_success

static:phpcs:
  rules:
    - if: $RUN_ONLY != ''
      when: never
    - when: on_success

test:integration:
  extends: .test:integration
  rules:
    - if: $RUN_ONLY != '' && $RUN_ONLY != "integration"
      when: never
    - if: $RUN_ONLY == "integration"
      needs: []
    - when: on_success
  parallel:
    matrix:
      - MAGEVERSION: ['2.4.8-p3']

test:playwright:
  extends: .test:theme_playwright
  rules:
    - if: $RUN_ONLY != '' && $RUN_ONLY != "playwright"
      when: never
    - if: $RUN_ONLY == "playwright"
      needs: []
    - when: on_success
  parallel:
    matrix:
      - MAGEVERSION: ['2.4.8-p3']
